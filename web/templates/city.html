<!DOCTYPE html>
<html>

<head>
    <title>City</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>

<body>
    <h1>{{ city|capitalize }}</h1>
    <h2>Datos recopilados del Orion Context Broker</h2>
    <p style="font-size: large;">Se han encontrado {{ routes|length }} rutas de transporte y {{ stops|length }} paradas.
    </p>

    <a href="/cities/{{ city }}/routes" class="btn btn-primary">Ver rutas</a>
    <a href="/cities/{{ city }}/stops" class="btn btn-primary">Ver paradas</a>
    <a href="/SUMO-conversion" class="btn btn-secondary">Volver</a>

    <h2>Convertir los datos de nuevo a SUMO</h2>
    <p style="font-size: large;">Si ya has terminado de editar los datos de transporte puedes convertir los datos a SUMO
        para lanzar una simulaci√≥n.</p>
    <input type="hidden" id="citySelect" value="{{ city }}">
    <button class="btn btn-primary" id="convertToSUMO">Convertir a SUMO</button>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            // Add a click event listener to the "convertToSUMO"
            $('#convertToSUMO').click(function () {
                // Get the selected city from the input hidden field
                var city = $('#citySelect').val();

                // Show the spinner
                $('#loadingSpinner').show();

                // Send a POST request to the "/FIWARE-conversion" endpoint
                $.ajax({
                    url: '/FIWARE-conversion',
                    type: 'POST',
                    data: JSON.stringify({ city: city }),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    async: true,
                    success: function (msg) {
                        // Hide the spinner
                        $('#loadingSpinner').hide();

                        alert('Se han convertido los datos de ' + city + ' a SUMO correctamente.');
                        window.location.href = '/';
                    }
                });
            });
        });
    </script>
</body>

</html>